<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <title>LIFF User Form</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #ffe05c;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .card-container {
      width: 90%;
      max-width: 400px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      padding: 20px;
      position: relative;
      overflow: hidden;
      transition: transform 0.4s ease;
    }
    .card-slide {
      display: none;
    }
    .card-slide.active {
      display: block;
      animation: slideIn 0.4s ease forwards;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .nav-btns {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background: #004aad;
      color: white;
      cursor: pointer;
    }
    input, select {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }
    #progress-bar-wrapper {
      width: 100%;
      height: 8px;
      background-color: #eee;
      margin-bottom: 10px;
      border-radius: 4px;
      overflow: hidden;
    }
    #progress-bar {
      height: 100%;
      width: 0%;
      background-color: #4CAF50;
      transition: width 0.3s ease;
    }
  </style>
</head>
<body>
  <div id="progress-bar-wrapper">
    <div id="progress-bar"></div>
  </div>
  <div class="card-container">
    <div class="card-slide active" id="step-0">
      <h3>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
      <select id="role">
        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
        <option value="‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà">‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</option>
        <option value="‡∏ô‡∏±‡∏Å‡∏•‡∏á‡∏ó‡∏∏‡∏ô">‡∏´‡∏≤‡∏≠‡∏™‡∏±‡∏á‡∏´‡∏≤‡∏•‡∏á‡∏ó‡∏∏‡∏ô</option>
        <option value="‡∏ü‡∏≤‡∏Å‡∏Ç‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå">‡∏ü‡∏≤‡∏Å‡∏Ç‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</option>
      </select>
      <div class="nav-btns">
        <div></div>
        <button onclick="nextStep()">‚ñ∂</button>
      </div>

  <script>
    const container = document.querySelector('.card-container');
    let currentStep = 0;
    let role = '';
    const steps = [];

    async function main() {
      await liff.init({ liffId: '2007520214-3V1lDOWV' });
    }

    function updateProgressBar() {
      const totalSteps = document.querySelectorAll('.card-slide').length - 1; // ‡∏•‡∏ö step-0
      const progress = Math.min((currentStep / totalSteps) * 100, 100);
      document.getElementById('progress-bar').style.width = `${progress}%`;
    }
    const formData = {};

    function nextStep() {
      const current = document.getElementById(`step-${currentStep}`);
      const inputs = current.querySelectorAll('input, select');
      for (const input of inputs) {
        const isRequired = input.hasAttribute('required');
        if (isRequired && !input.value) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
          return;
        }
        // ‡πÉ‡∏ä‡πâ placeholder ‡πÄ‡∏õ‡πá‡∏ô key ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ id
        const key = input.placeholder || input.id || `field_${currentStep}_${input.name || input.tagName}`;
        formData[key] = input.value;
      }
      // Step 0 (role)
      if (currentStep === 0) {
        role = formData['role'];
        if (!role) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó');
        buildSteps();
      }
      const next = document.getElementById(`step-${currentStep + 1}`);
      if (next) {
        current.classList.remove('active');
        currentStep++;
        next.classList.add('active');
        if (next.querySelector('#summary-content')) {
          updateSummary();
        }
      next.classList.add('active');
      updateProgressBar();
      }
    }

    function prevStep() {
      const current = document.getElementById(`step-${currentStep}`);
      if (currentStep > 0) {
        current.classList.remove('active');
        currentStep--;
        const previous = document.getElementById(`step-${currentStep}`);
        if (previous) {
          previous.classList.add('active');
        }
        updateProgressBar();
      }
    }

    function updateSummary() {
        const summary = document.getElementById('summary-content');
        if (!summary) return;

        // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å input ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å slide ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        const inputs = document.querySelectorAll('.card-slide input, .card-slide select');
        const values = [];
        inputs.forEach(input => {
            if (input.closest('.card-slide').id !== `step-${currentStep}`) {
            const label = input.placeholder || input.id || input.previousElementSibling?.textContent ;
            values.push(`<p><strong>${label}:</strong> ${input.value || '(‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á)'}</p>`);
            }
        });

        summary.innerHTML = values.join('');
        }
    
    function buildSteps() {
      const html = [];
      let stepId = 1;
      const addSlide = (content) => {
        html.push(`<div class="card-slide" id="step-${stepId}">${content}</div>`);
        stepId++;
      };

      if (role === '‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà' || role === '‡∏ô‡∏±‡∏Å‡∏•‡∏á‡∏ó‡∏∏‡∏ô') {
        addSlide(`
          <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</h3>
          <input placeholder="‡∏ä‡∏∑‡πà‡∏≠" />
          <input placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" />
          <input placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" />
          <div class="nav-btns">
            <button onclick="prevStep()">‚óÄ</button>
            <button onclick="nextStep()">‚ñ∂</button>
          </div>
        `);
        addSlide(`
          <h3>‡∏ã‡∏∑‡πâ‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏ä‡πà‡∏≤</h3>
          <select required />
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
            <option value="‡∏ã‡∏∑‡πâ‡∏≠">‡∏ã‡∏∑‡πâ‡∏≠</option>
            <option value="‡πÄ‡∏ä‡πà‡∏≤">‡πÄ‡∏ä‡πà‡∏≤</option>
          </select>
          <div class="nav-btns">
            <button onclick="prevStep()">‚óÄ</button>
            <button onclick="nextStep()">‚ñ∂</button>
          </div>
        `);
        addSlide(`
          <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h3>
          <select required / id="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" onchange="loadDistricts()">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î --</option>
            <option>‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£</option>
            <option>‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</option>
          </select>
          <select id="‡∏≠‡∏≥‡πÄ‡∏†‡∏≠">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ --</option>
          </select>
          <div class="nav-btns">
            <button onclick="prevStep()">‚óÄ</button>
            <button onclick="nextStep()">‚ñ∂</button>
          </div>
        `);
      }

      if (role === '‡∏ü‡∏≤‡∏Å‡∏Ç‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå') {
        addSlide(`
          <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)</h3>
          <input placeholder="‡∏ä‡∏∑‡πà‡∏≠" required />
          <input placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required />
          <input placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" inputmode="numeric" pattern="[0-9]*" maxlength="10" oninput="this.value = this.value.replace(/[^0-9]/g, '')" required />
          <div class="nav-btns">
            <button onclick="prevStep()">‚óÄ</button>
            <button onclick="nextStep()">‚ñ∂</button>
          </div>
        `);
        addSlide(`
          <h3>‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠?</h3>
          <select>
            <option>‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</option>
            <option>‡∏ô‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏™‡∏±‡∏á‡∏´‡∏≤‡∏£‡∏¥‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</option>
          </select>
          <div class="nav-btns">
            <button onclick="prevStep()">‚óÄ</button>
            <button onclick="nextStep()">‚ñ∂</button>
          </div>
        `);
      }

      addSlide(`
        <h3>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á</h3>
        <div id="summary-content"></div>
        <div class="nav-btns">
            <button onclick="prevStep()">‚óÄ</button>
            <button onclick="submitForm()">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
        `);

    document.querySelectorAll('.card-slide:not(#step-0)').forEach(el => el.remove());
    document.querySelector('.card-container').insertAdjacentHTML('beforeend', html.join(''));
    }

    function loadDistricts() {
      const province = document.getElementById('‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î').value;
      const district = document.getElementById('‡∏≠‡∏≥‡πÄ‡∏†‡∏≠');
      district.innerHTML = '';
      if (province === '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£') {
        district.innerHTML += '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ --</option><option>‡∏ö‡∏≤‡∏á‡∏ô‡∏≤</option><option>‡∏î‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á</option>';
      } else if (province === '‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà') {
        district.innerHTML += '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ --</option><option>‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</option><option>‡πÅ‡∏°‡πà‡∏£‡∏¥‡∏°</option>';
      }
    }

    async function submitForm() {
      const lines = [`üìã ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°`, `‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ${role}`];
      for (const [key, val] of Object.entries(formData)) {
        lines.push(`${key}: ${val}`);
      }
      const message = lines.join('\n');

      if (typeof liff !== 'undefined' && liff.isInClient()) {
        liff.sendMessages([{ type: 'text', text: message }])
          .then(() => liff.closeWindow())
          .catch(err => alert('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err));
      } else {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡πÅ‡∏≠‡∏û LINE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
      }
    }

    main();
  </script>
</body>
</html>
